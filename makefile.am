PROGNAME = digdug2
MAIN_AGA = ..\$(PROGNAME)_aga
MAIN_ECS = ..\$(PROGNAME)_ecs
MAIN_OCS = ..\$(PROGNAME)_ocs
AMIGA_SHELL = ..\$(PROGNAME)

ifdef RELEASE_BUILD
OPT_RELEASE = --defsym RELEASE=1
endif

# Bebbo's package usually installs itself there
GCC_BIN = C:\amiga-gcc\bin
ASM_BASE = $(GCC_BIN)/m68k-amigaos-as -c --defsym __amiga__=1 $(OPT_RELEASE)
ASM_000 = $(ASM_BASE) -m68000
ASM_000_OCS = $(ASM_000) --defsym OCS_VERSION=0
ASM_000_ECS = $(ASM_000) --defsym OCS_VERSION=1
ASM_020 = $(ASM_BASE) -m68020 --defsym MC68020=1
ASM = $(ASM_000)
MAIN_OBJ = amiga.o
WHDLOADER_AGA = ..\$(PROGNAME)_AGA.slave
WHDLOADER_AGA_CHIP = ..\$(PROGNAME)_AGA_chip.slave
WHDLOADER_ECS = ..\$(PROGNAME)_ECS.slave
WHDLOADER_ECS_CHIP = ..\$(PROGNAME)_ECS_chip.slave
BASE_ASSETS = ..\assets
ASSETS = $(BASE_ASSETS)\amiga
AMIGASRC = amiga




# those 2 are defined for my PC, should include whdload.i
# and system includes.
HDBASE = K:\jff\AmigaHD
WHDBASE = $(HDBASE)\PROJETS\HDInstall\DONE\WHDLoad
WHDASM = vasmm68k_mot -DDATETIME -I$(HDBASE)/amiga39_JFF_OS/include -I$(WHDBASE)\Include -I$(WHDBASE) -devpac -nosym -Fhunkexe


# leave MAIN_OBJ first
AGA_OBJS = amiga_aga.o sounds.o $(PROGNAME)_020.o ram.o graphics_aga.o rom.o vbr.o ReadJoyPad.o ptplayer.o 
OCS_OBJS = amiga_ocs.o sounds_ocs.o $(PROGNAME)_000.o ram.o graphics_ecs.o rom.o vbr.o ReadJoyPad.o ptplayer.o 
ECS_OBJS = amiga_ecs.o sounds.o $(PROGNAME)_000.o ram.o graphics_ecs.o rom.o vbr.o ReadJoyPad.o ptplayer.o 

all: $(AMIGA_SHELL) $(MAIN_AGA) $(MAIN_ECS) $(MAIN_OCS) $(WHDLOADER_ECS) $(WHDLOADER_ECS_CHIP) $(WHDLOADER_AGA) $(WHDLOADER_AGA_CHIP) $(AMIGASRC)/aga/graphics.68k $(AMIGASRC)/sounds.68k $(AMIGASRC)/ocs/sounds.68k
 
$(AMIGA_SHELL): shell.o
	$(GCC_BIN)/m68k-amigaos-ld $(OPT_RELEASE_LINK) -o $(AMIGA_SHELL) shell.o

# don't clean shell "digdug2" program, update_floppy will need it
clean:
	del $(AGA_OBJS) $(OCS_OBJS) $(ECS_OBJS) "$(MAIN_AGA)" "$(MAIN_OCS)" "$(MAIN_ECS)"
	
shell.o: $(AMIGASRC)/shell.68k
	$(ASM_000) -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/shell.68k -o shell.o
$(AMIGASRC)/aga/graphics.68k: $(ASSETS)/convert_graphics_aga.py
	cmd /c $(ASSETS)\convert_graphics_aga.py
$(AMIGASRC)/ecs/graphics.68k: $(ASSETS)/convert_graphics_ecs.py
	cmd /c $(ASSETS)\convert_graphics_ecs.py

$(AMIGASRC)/sounds.68k: $(ASSETS)/convert_sounds.py $(BASE_ASSETS)/sounds/digdug2_main_tune.mod $(BASE_ASSETS)/sounds/digdug2_others.mod 
	cmd /c $(ASSETS)\convert_sounds.py
	del sounds.o sounds_ocs.o 
	
$(MAIN_AGA): $(AGA_OBJS)
	$(GCC_BIN)/m68k-amigaos-ld $(OPT_RELEASE_LINK) -o $(MAIN_AGA) $(AGA_OBJS)
$(MAIN_OCS): $(OCS_OBJS)
	$(GCC_BIN)/m68k-amigaos-ld $(OPT_RELEASE_LINK) -o $(MAIN_OCS) $(OCS_OBJS)
$(MAIN_ECS): $(ECS_OBJS)
	$(GCC_BIN)/m68k-amigaos-ld $(OPT_RELEASE_LINK) -o $(MAIN_ECS) $(ECS_OBJS)

ram.o: ram.68k options.inc
	$(ASM_BASE) ram.68k -o ram.o
rom.o: rom.68k
	$(ASM_BASE) rom.68k -o rom.o
$(PROGNAME)_020.o: $(PROGNAME).68k options.inc include.inc sounds.inc data.inc
	$(ASM_020) $(PROGNAME).68k -o $(PROGNAME)_020.o
$(PROGNAME)_000.o: $(PROGNAME).68k options.inc include.inc sounds.inc data.inc
	$(ASM_000) $(PROGNAME).68k -o $(PROGNAME)_000.o
amiga_aga.o: $(AMIGASRC)/amiga.68k options.inc include.inc data.inc $(AMIGASRC)/ReadJoyPad.i $(AMIGASRC)/aga/palette.68k $(AMIGASRC)/aga/graphics.68k $(AMIGASRC)/sound_entries.68k  $(AMIGASRC)/scroll_table_64.68k
	$(ASM_020) -I$(AMIGASRC)/aga -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/amiga.68k -o amiga_aga.o
amiga_ecs.o: $(AMIGASRC)/amiga.68k options.inc include.inc data.inc $(AMIGASRC)/ReadJoyPad.i $(AMIGASRC)/ecs/palette.68k $(AMIGASRC)/sound_entries.68k $(AMIGASRC)/scroll_table_16.68k
	$(ASM_000_ECS) -I$(AMIGASRC)/ecs -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/amiga.68k -o amiga_ecs.o
amiga_ocs.o: $(AMIGASRC)/amiga.68k options.inc include.inc data.inc $(AMIGASRC)/ReadJoyPad.i $(AMIGASRC)/ecs/palette.68k $(AMIGASRC)/ocs/sound_entries.68k $(AMIGASRC)/scroll_table_16.68k
	$(ASM_000_OCS) -I$(AMIGASRC)/ocs -I$(AMIGASRC)/ecs -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/amiga.68k -o amiga_ocs.o
vbr.o: $(AMIGASRC)/vbr.68k
	$(ASM_020) -Iamiga $(AMIGASRC)/vbr.68k -o vbr.o
ptplayer.o: $(AMIGASRC)/ptplayer.68k
	$(ASM_000) -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/ptplayer.68k -o ptplayer.o
sounds.o: $(AMIGASRC)/sounds.68k
	$(ASM_BASE) -I$(AMIGASRC) $(AMIGASRC)/sounds.68k -o sounds.o
sounds_ocs.o: $(AMIGASRC)/ocs/sounds.68k
	$(ASM_000_OCS) -I$(AMIGASRC) $(AMIGASRC)/ocs/sounds.68k -o sounds_ocs.o
ReadJoyPad.o: $(AMIGASRC)/ReadJoyPad.68k amiga/ReadJoyPad.i
	$(ASM_BASE) -I$(AMIGASRC) -I$(AMIGASRC)/mit_includes $(AMIGASRC)/ReadJoyPad.68k -o ReadJoyPad.o
graphics_aga.o: $(AMIGASRC)/aga/graphics.68k
	$(ASM_BASE) $(AMIGASRC)/aga/graphics.68k -o graphics_aga.o
graphics_ecs.o: $(AMIGASRC)/ecs/graphics.68k
	$(ASM_BASE) $(AMIGASRC)/ecs/graphics.68k -o graphics_ecs.o


$(WHDLOADER_AGA) : $(AMIGASRC)/aga/$(PROGNAME)HD.s
	wdate.py> datetime
	$(WHDASM) -o $(WHDLOADER_AGA) $(AMIGASRC)/aga/$(PROGNAME)HD.s
	
$(WHDLOADER_AGA_CHIP) : $(AMIGASRC)/aga/$(PROGNAME)HD.s
	wdate.py> datetime
	$(WHDASM) -DCHIP_ONLY -o $(WHDLOADER_AGA_CHIP) $(AMIGASRC)/aga/$(PROGNAME)HD.s

$(WHDLOADER_ECS) : $(AMIGASRC)/ecs/$(PROGNAME)HD.s
	wdate.py> datetime
	$(WHDASM) -o $(WHDLOADER_ECS) $(AMIGASRC)/ecs/$(PROGNAME)HD.s
	
$(WHDLOADER_ECS_CHIP) : $(AMIGASRC)/ecs/$(PROGNAME)HD.s
	wdate.py> datetime
	$(WHDASM) -DCHIP_ONLY -o $(WHDLOADER_ECS_CHIP) $(AMIGASRC)/ecs/$(PROGNAME)HD.s
